<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repo Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }
        
        .image-card:hover .overlay {
            opacity: 1;
        }
        
        /* Loading Spinner Animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Smooth fade in for images */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col">

    <!-- Navbar / Settings -->
    <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                
                <div class="flex items-center gap-3">
                    <i class="fa-brands fa-github text-3xl text-white"></i>
                    <h1 class="text-xl font-bold tracking-tight text-white">Auto-Gallery</h1>
                </div>

                <!-- Controls -->
                <div class="w-full md:w-auto flex flex-col sm:flex-row gap-2 items-center bg-gray-900 p-2 rounded-lg border border-gray-700">
                    <div class="relative w-full sm:w-32">
                        <label class="absolute -top-2 left-2 bg-gray-900 px-1 text-xs text-blue-400">User</label>
                        <input type="text" id="inputUser" placeholder="Username" class="w-full bg-gray-800 border border-gray-600 text-sm rounded px-3 py-2 focus:outline-none focus:border-blue-500 transition-colors">
                    </div>
                    <div class="relative w-full sm:w-32">
                        <label class="absolute -top-2 left-2 bg-gray-900 px-1 text-xs text-blue-400">Repo</label>
                        <input type="text" id="inputRepo" placeholder="Repository" class="w-full bg-gray-800 border border-gray-600 text-sm rounded px-3 py-2 focus:outline-none focus:border-blue-500 transition-colors">
                    </div>
                    <div class="relative w-full sm:w-32">
                        <label class="absolute -top-2 left-2 bg-gray-900 px-1 text-xs text-blue-400">Folder (Optional)</label>
                        <input type="text" id="inputPath" placeholder="images" class="w-full bg-gray-800 border border-gray-600 text-sm rounded px-3 py-2 focus:outline-none focus:border-blue-500 transition-colors">
                    </div>
                    <button onclick="loadGallery()" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm font-medium transition-colors flex items-center justify-center gap-2">
                        <i class="fa-solid fa-sync-alt"></i> Load
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <!-- Error Message -->
        <div id="error-container" class="hidden max-w-2xl mx-auto bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded relative mb-6" role="alert">
            <strong class="font-bold">Oops!</strong>
            <span class="block sm:inline" id="error-message">Something went wrong.</span>
        </div>

        <!-- Status Bar -->
        <div class="flex justify-between items-center mb-6 text-gray-400 text-sm px-2">
            <span id="status-text">Ready to load.</span>
            <div class="flex gap-2">
                <button onclick="toggleLayout('grid')" class="hover:text-white transition-colors"><i class="fa-solid fa-th-large"></i></button>
                <button onclick="toggleLayout('list')" class="hover:text-white transition-colors"><i class="fa-solid fa-list"></i></button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="hidden flex justify-center items-center py-20">
            <div class="loader"></div>
        </div>

        <!-- Gallery Grid -->
        <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Images injected here by JS -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-gray-500">
            <i class="fa-regular fa-folder-open text-6xl mb-4"></i>
            <p class="text-lg">No images found in this location.</p>
            <p class="text-sm mt-2">Check your path settings or upload some files!</p>
        </div>

    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-[100] hidden bg-black/95 backdrop-blur-sm flex items-center justify-center p-4">
        <button onclick="closeLightbox()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-4xl z-50">
            <i class="fa-solid fa-times"></i>
        </button>
        
        <div class="relative w-full max-w-6xl max-h-screen flex flex-col items-center justify-center">
            <img id="lightbox-img" src="" alt="Full View" class="max-h-[85vh] w-auto object-contain rounded-md shadow-2xl border border-gray-800">
            
            <div class="mt-4 flex gap-4">
                <a id="lightbox-download" href="#" target="_blank" download class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full font-medium transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-download"></i> Download
                </a>
                <a id="lightbox-raw" href="#" target="_blank" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-full font-medium transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-external-link-alt"></i> Open Raw
                </a>
            </div>
        </div>
    </div>

    <footer class="bg-gray-900 border-t border-gray-800 py-6 text-center text-gray-500 text-sm">
        <p>Images loaded directly from GitHub repository.</p>
    </footer>

    <script>
        // --- Configuration ---
        const ALLOWED_EXTENSIONS = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'];
        
        // DOM Elements
        const els = {
            user: document.getElementById('inputUser'),
            repo: document.getElementById('inputRepo'),
            path: document.getElementById('inputPath'),
            gallery: document.getElementById('gallery'),
            loader: document.getElementById('loader'),
            error: document.getElementById('error-container'),
            errorMsg: document.getElementById('error-message'),
            empty: document.getElementById('empty-state'),
            status: document.getElementById('status-text'),
            lightbox: document.getElementById('lightbox'),
            lightboxImg: document.getElementById('lightbox-img'),
            lightboxBtn: document.getElementById('lightbox-download'),
            lightboxRaw: document.getElementById('lightbox-raw'),
        };

        // --- Initialization ---
        window.onload = () => {
            autoDetectConfig();
            // Optional: Load automatically on visit if configs are detected
            if (els.user.value && els.repo.value) {
                loadGallery();
            }
        };

        // Try to detect User and Repo from the URL (if hosted on GitHub Pages)
        function autoDetectConfig() {
            const hostname = window.location.hostname;
            const pathname = window.location.pathname;

            // Case 1: username.github.io/repo-name
            if (hostname.includes('github.io')) {
                const user = hostname.split('.')[0];
                const pathParts = pathname.split('/').filter(p => p); // Remove empty strings
                const repo = pathParts[0];
                
                if (user) els.user.value = user;
                if (repo) els.repo.value = repo;
            } 
            // Case 2: Localhost or other (Use placeholders or local storage could go here)
            else {
                // Default fallback or leave empty
                // els.user.value = 'github-username'; 
            }
        }

        // --- Main Logic ---
        async function loadGallery() {
            const user = els.user.value.trim();
            const repo = els.repo.value.trim();
            const path = els.path.value.trim();

            if (!user || !repo) {
                showError("Please enter a GitHub Username and Repository.");
                return;
            }

            // UI Reset
            els.gallery.innerHTML = '';
            els.error.classList.add('hidden');
            els.empty.classList.add('hidden');
            els.loader.classList.remove('hidden');
            els.status.innerText = `Scanning ${user}/${repo}/${path}...`;

            try {
                // Fetch directory contents from GitHub API
                // Note: This is unauthenticated (60 requests/hr limit per IP). 
                // For personal use it's usually fine.
                const apiUrl = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    if (response.status === 404) throw new Error("Folder or Repository not found.");
                    if (response.status === 403) throw new Error("Rate limit exceeded. Try again in an hour.");
                    throw new Error(`GitHub API Error: ${response.status}`);
                }

                const data = await response.json();

                // Filter for images
                if (!Array.isArray(data)) {
                    throw new Error("Path provided is not a folder.");
                }

                const images = data.filter(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    return file.type === 'file' && ALLOWED_EXTENSIONS.includes(ext);
                });

                els.loader.classList.add('hidden');

                if (images.length === 0) {
                    els.empty.classList.remove('hidden');
                    els.status.innerText = "No images found.";
                    return;
                }

                els.status.innerText = `Found ${images.length} images.`;
                renderImages(images);

            } catch (err) {
                els.loader.classList.add('hidden');
                showError(err.message);
            }
        }

        function renderImages(images) {
            images.forEach(img => {
                // Create Card
                const card = document.createElement('div');
                card.className = "image-card relative group bg-gray-800 rounded-lg overflow-hidden shadow-lg border border-gray-700 aspect-square fade-in cursor-pointer hover:border-blue-500 transition-all duration-200";
                card.onclick = (e) => {
                    // Prevent lightbox if clicking download specifically
                    if(e.target.closest('.download-btn')) return;
                    openLightbox(img.download_url, img.name);
                };

                // Image Element
                // loading="lazy" helps performance
                const imageEl = document.createElement('img');
                imageEl.src = img.download_url; 
                imageEl.alt = img.name;
                imageEl.className = "w-full h-full object-cover transition-transform duration-500 group-hover:scale-110";
                
                // Overlay (Hover State)
                const overlay = document.createElement('div');
                overlay.className = "overlay absolute inset-0 bg-black/60 opacity-0 transition-opacity duration-300 flex flex-col justify-end p-4";
                
                // File Info in Overlay
                const info = document.createElement('div');
                info.className = "text-white";
                info.innerHTML = `
                    <p class="font-semibold text-sm truncate">${img.name}</p>
                    <p class="text-xs text-gray-300">${(img.size / 1024).toFixed(1)} KB</p>
                `;

                // Download Button (Small icon in corner)
                const dlBtn = document.createElement('a');
                dlBtn.href = img.download_url;
                // Note: 'download' attr works best for same-origin, but we add it anyway.
                dlBtn.download = img.name; 
                dlBtn.target = "_blank"; 
                dlBtn.className = "download-btn absolute top-2 right-2 bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full shadow-lg transform translate-y-[-10px] opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300";
                dlBtn.innerHTML = '<i class="fa-solid fa-download text-xs"></i>';
                dlBtn.title = "Download";

                card.appendChild(imageEl);
                card.appendChild(overlay);
                overlay.appendChild(info);
                card.appendChild(dlBtn);
                els.gallery.appendChild(card);
            });
        }

        // --- Helpers ---

        function showError(msg) {
            els.errorMsg.innerText = msg;
            els.error.classList.remove('hidden');
        }

        function openLightbox(url, name) {
            els.lightboxImg.src = url;
            els.lightboxBtn.href = url;
            els.lightboxBtn.download = name;
            els.lightboxRaw.href = url;
            els.lightbox.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling bg
        }

        function closeLightbox() {
            els.lightbox.classList.add('hidden');
            els.lightboxImg.src = '';
            document.body.style.overflow = 'auto';
        }

        // Close lightbox on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeLightbox();
            }
        });

        // Close lightbox when clicking outside image
        els.lightbox.addEventListener('click', function(e) {
            if (e.target === els.lightbox) {
                closeLightbox();
            }
        });

        function toggleLayout(type) {
            if(type === 'list') {
                els.gallery.className = "grid grid-cols-1 gap-4";
            } else {
                els.gallery.className = "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6";
            }
        }
    </script>
</body>
</html>
