<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lofi Cloud Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Soft, rounded font for Lofi vibes -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-highlight: rgba(255, 255, 255, 0.05);
            --accent-color: #e0b0ff; /* Soft Lavender */
            --text-main: #ffffff;
            --text-muted: #d1d5db;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #2d1b4e; /* Fallback color */
            /* Lofi Background Image */
            background-image: linear-gradient(rgba(20, 10, 40, 0.6), rgba(20, 10, 40, 0.8)), 
                              url('https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
        }

        /* Glassmorphism Utility Class */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        /* Inputs */
        input {
            background: rgba(0, 0, 0, 0.3) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 12px !important;
            font-family: 'Quicksand', sans-serif;
            transition: all 0.3s ease;
        }
        input:focus {
            background: rgba(0, 0, 0, 0.5) !important;
            border-color: var(--accent-color) !important;
            outline: none;
            box-shadow: 0 0 15px rgba(224, 176, 255, 0.2);
        }

        /* Buttons */
        .lofi-btn {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .lofi-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-color: var(--accent-color);
        }
        .lofi-btn:active {
            transform: translateY(0);
        }

        /* Image Cards */
        .image-card {
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(0,0,0,0.2);
        }
        .image-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            border-color: var(--accent-color);
        }
        
        /* Floating Animation for Empty State */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }
        .floating { animation: float 6s ease-in-out infinite; }

        /* Smooth Fade In */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loader Animation */
        .loader-ring {
            display: inline-block;
            width: 40px;
            height: 40px;
        }
        .loader-ring:after {
            content: " ";
            display: block;
            width: 32px;
            height: 32px;
            margin: 4px;
            border-radius: 50%;
            border: 3px solid #fff;
            border-color: #fff transparent #fff transparent;
            animation: loader-ring 1.2s linear infinite;
        }
        @keyframes loader-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body class="flex flex-col">

    <!-- Header -->
    <header class="sticky top-4 z-50 px-4 mb-4">
        <div class="glass max-w-7xl mx-auto rounded-2xl px-6 py-4 shadow-lg">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-6">
                
                <div class="flex items-center gap-4 group cursor-default">
                    <div class="bg-white/10 p-2 rounded-full">
                        <i class="fa-brands fa-github text-3xl text-white drop-shadow-md"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold tracking-wide text-white">Lofi Gallery</h1>
                        <p class="text-xs text-gray-300 tracking-wider">cloud_storage â€¢ aesthetic</p>
                    </div>
                </div>

                <!-- Controls -->
                <div class="w-full lg:w-auto flex flex-col sm:flex-row gap-3 items-center">
                    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto bg-black/20 p-2 rounded-xl">
                        <input type="text" id="inputUser" placeholder="Username" class="w-full sm:w-32 px-4 py-2 text-sm placeholder-gray-400">
                        <input type="text" id="inputRepo" placeholder="Repository" class="w-full sm:w-32 px-4 py-2 text-sm placeholder-gray-400">
                        <input type="text" id="inputPath" placeholder="Folder" class="w-full sm:w-24 px-4 py-2 text-sm placeholder-gray-400">
                    </div>
                    <button onclick="loadGallery()" class="lofi-btn px-8 py-2.5 font-semibold w-full sm:w-auto flex items-center justify-center gap-2 bg-white/10">
                        <i class="fa-solid fa-cloud-arrow-down"></i> Load
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 pb-12 relative z-10">
        
        <!-- Status / Welcome Message -->
        <div class="text-center mb-8 mt-4">
            <p id="status-text" class="text-lg text-purple-100 font-light tracking-wide opacity-90">
                Enter your repository details to begin studying...
            </p>
        </div>

        <!-- Error Box -->
        <div id="error-container" class="hidden max-w-xl mx-auto glass border-l-4 border-red-400 p-4 mb-8 rounded-r-xl text-white flex items-start gap-3 animate-pulse">
            <i class="fa-solid fa-circle-exclamation mt-1 text-red-300"></i>
            <div>
                <strong class="block text-red-200">Oops, small hiccup.</strong>
                <span id="error-message" class="text-sm opacity-90"></span>
            </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="hidden flex flex-col justify-center items-center py-32">
            <div class="loader-ring mb-4"></div>
            <p class="text-xl font-light tracking-widest text-white/80">LOADING ASSETS...</p>
        </div>

        <!-- Gallery Grid -->
        <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Images injected here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 floating">
            <div class="bg-white/5 p-8 rounded-full mb-6 backdrop-blur-sm">
                <i class="fa-solid fa-moon text-6xl text-purple-200"></i>
            </div>
            <p class="text-2xl font-light text-white">It's quiet here...</p>
            <p class="text-sm text-purple-200 mt-2 opacity-70">Try a different folder path</p>
        </div>

    </main>

    <!-- Glass Lightbox -->
    <div id="lightbox" class="fixed inset-0 z-[100] hidden bg-[#1a102e]/95 backdrop-blur-md flex flex-col animate-fade-in">
        <!-- Header -->
        <div class="absolute top-0 left-0 right-0 p-6 flex justify-between items-center z-50">
            <div class="flex flex-col text-shadow">
                <span class="text-xs text-purple-300 uppercase tracking-widest">Viewing</span>
                <span id="lb-filename" class="text-xl font-medium text-white">image.jpg</span>
            </div>
            <button onclick="closeLightbox()" class="bg-white/10 hover:bg-white/20 text-white rounded-full w-10 h-10 flex items-center justify-center transition-all">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>
        
        <!-- Image Container -->
        <div class="flex-grow flex items-center justify-center p-4 sm:p-12 h-full" onclick="closeLightbox()">
            <img id="lightbox-img" src="" class="max-h-full max-w-full object-contain rounded-lg shadow-2xl ring-1 ring-white/10" style="max-height: 85vh;">
        </div>

        <!-- Floating Footer Controls -->
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 glass px-6 py-3 rounded-full flex gap-6 z-50">
            <a id="lb-dl-btn" href="#" target="_blank" download class="text-white hover:text-purple-300 transition-colors flex items-center gap-2 text-sm font-medium">
                <i class="fa-solid fa-download"></i> Save
            </a>
            <div class="w-px bg-white/20 h-5 self-center"></div>
            <a id="lb-raw-btn" href="#" target="_blank" class="text-white hover:text-purple-300 transition-colors flex items-center gap-2 text-sm font-medium">
                <i class="fa-solid fa-arrow-up-right-from-square"></i> Open
            </a>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const ALLOWED_EXTENSIONS = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
        // wsrv.nl proxy for fast thumbnails
        const PROXY_BASE = "https://wsrv.nl/";
        
        const els = {
            user: document.getElementById('inputUser'),
            repo: document.getElementById('inputRepo'),
            path: document.getElementById('inputPath'),
            gallery: document.getElementById('gallery'),
            loader: document.getElementById('loader'),
            error: document.getElementById('error-container'),
            errorMsg: document.getElementById('error-message'),
            empty: document.getElementById('empty-state'),
            status: document.getElementById('status-text'),
            lightbox: document.getElementById('lightbox'),
            lbImg: document.getElementById('lightbox-img'),
            lbName: document.getElementById('lb-filename'),
            lbDl: document.getElementById('lb-dl-btn'),
            lbRaw: document.getElementById('lb-raw-btn'),
        };

        window.onload = () => {
            autoDetectConfig();
            if (els.user.value && els.repo.value) {
                loadGallery();
            }
        };

        function autoDetectConfig() {
            const hostname = window.location.hostname;
            const pathname = window.location.pathname;
            if (hostname.includes('github.io')) {
                const user = hostname.split('.')[0];
                const pathParts = pathname.split('/').filter(p => p);
                const repo = pathParts[0];
                if (user) els.user.value = user;
                if (repo) els.repo.value = repo;
            }
        }

        function setStatus(msg, type = 'normal') {
            els.status.innerText = msg;
            els.status.className = type === 'error' 
                ? "text-red-300 font-medium mt-4" 
                : "text-lg text-purple-100 font-light tracking-wide opacity-90";
        }

        async function loadGallery() {
            const user = els.user.value.trim();
            const repo = els.repo.value.trim();
            const path = els.path.value.trim();

            if (!user || !repo) {
                setStatus("Please enter a valid GitHub Username and Repository.", 'error');
                return;
            }

            // Reset UI
            els.gallery.innerHTML = '';
            els.error.classList.add('hidden');
            els.empty.classList.add('hidden');
            els.loader.classList.remove('hidden');
            setStatus(`Connecting to ${user}/${repo}...`);

            try {
                const apiUrl = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    if(response.status === 404) throw new Error("Path not found. Is the repo private or path wrong?");
                    throw new Error(`GitHub API Error: ${response.status}`);
                }

                const data = await response.json();

                if (!Array.isArray(data)) throw new Error("This path leads to a file, not a folder.");

                const images = data.filter(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    return file.type === 'file' && ALLOWED_EXTENSIONS.includes(ext);
                });

                els.loader.classList.add('hidden');

                if (images.length === 0) {
                    els.empty.classList.remove('hidden');
                    setStatus("");
                    return;
                }

                setStatus(`Found ${images.length} moments.`);
                renderImages(images);

            } catch (err) {
                els.loader.classList.add('hidden');
                els.errorMsg.innerText = err.message;
                els.error.classList.remove('hidden');
                setStatus("Something went wrong.", 'error');
            }
        }

        function renderImages(images) {
            images.forEach((img, index) => {
                // Use proxy for optimized thumbnails
                const thumbUrl = `${PROXY_BASE}?url=${encodeURIComponent(img.download_url)}&w=400&q=60&output=webp`;

                const card = document.createElement('div');
                card.className = "image-card relative aspect-square cursor-pointer group glass fade-in-up";
                card.style.animationDelay = `${index * 50}ms`;

                card.onclick = () => openLightbox(img.download_url, img.name);

                card.innerHTML = `
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10 flex flex-col justify-end p-4">
                        <p class="text-white font-medium text-sm truncate shadow-sm">${img.name}</p>
                        <p class="text-purple-200 text-xs">${(img.size / 1024).toFixed(0)} KB</p>
                    </div>
                    <img src="${thumbUrl}" 
                         loading="lazy" 
                         alt="${img.name}" 
                         class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    
                    <!-- Hover download icon -->
                    <div class="absolute top-3 right-3 bg-white/20 backdrop-blur-sm p-2 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0 hover:bg-white/40 z-20">
                        <i class="fa-solid fa-expand text-white text-xs"></i>
                    </div>
                `;

                els.gallery.appendChild(card);
            });
        }

        function openLightbox(url, name) {
            els.lbImg.src = url;
            els.lbName.innerText = name;
            els.lbDl.href = url;
            els.lbDl.download = name;
            els.lbRaw.href = url;
            
            els.lightbox.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            els.lightbox.classList.add('hidden');
            els.lbImg.src = '';
            document.body.style.overflow = 'auto';
        }

        document.addEventListener('keydown', (e) => {
            if(e.key === "Escape") closeLightbox();
        });

        els.lbDl.onclick = (e) => e.stopPropagation();
        els.lbRaw.onclick = (e) => e.stopPropagation();
    </script>
</body>
</html>
