<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM.GALLERY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
        /* --- LO-FI AESTHETICS --- */
        :root {
            --terminal-green: #33ff00;
            --terminal-dim: #1a5c00;
            --bg-color: #050505;
        }

        body {
            font-family: 'VT323', monospace;
            background-color: var(--bg-color);
            color: var(--terminal-green);
            overflow-x: hidden;
        }

        /* CRT Scanline Overlay */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            animation: scanlineMove 0.5s linear infinite;
        }

        /* Subtle CRT Flicker */
        .flicker-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(51, 255, 0, 0.02);
            opacity: 0;
            pointer-events: none;
            z-index: 9998;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.02; }
            50% { opacity: 0.05; }
            100% { opacity: 0.02; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #000; border-left: 1px solid var(--terminal-dim); }
        ::-webkit-scrollbar-thumb { background: var(--terminal-green); border: 2px solid #000; }
        ::-webkit-scrollbar-thumb:hover { background: #ccffcc; }

        /* Inputs */
        input {
            background: #000 !important;
            color: var(--terminal-green) !important;
            border: 1px dashed var(--terminal-dim) !important;
            border-radius: 0 !important;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }
        input:focus {
            border-color: var(--terminal-green) !important;
            box-shadow: 0 0 10px var(--terminal-dim);
            outline: none;
        }

        /* Buttons */
        .retro-btn {
            background: transparent;
            border: 2px solid var(--terminal-green);
            color: var(--terminal-green);
            text-transform: uppercase;
            box-shadow: 4px 4px 0px var(--terminal-dim);
            transition: all 0.1s;
        }
        .retro-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px var(--terminal-dim);
        }
        .retro-btn:hover {
            background: var(--terminal-green);
            color: #000;
        }

        /* Image Cards */
        .image-card {
            image-rendering: pixelated; /* Lo-fi look for images */
            border: 1px solid var(--terminal-dim);
            background: #000;
            transition: transform 0.2s ease;
        }
        .image-card:hover {
            border-color: var(--terminal-green);
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 0 15px var(--terminal-dim);
        }

        /* Loading Animation */
        .loader-text:after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80% { content: ' ....'; }
            100% { content: ' .....'; }
        }

        /* Pixelated Fade In */
        .pixel-in {
            animation: pixelIn 0.4s steps(5) forwards;
            opacity: 0;
        }
        @keyframes pixelIn {
            0% { opacity: 0; clip-path: inset(0 100% 0 0); }
            100% { opacity: 1; clip-path: inset(0 0 0 0); }
        }

    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-green-900 selection:text-white">

    <div class="scanlines"></div>
    <div class="flicker-overlay"></div>

    <!-- Header -->
    <header class="border-b border-green-900 sticky top-0 z-50 bg-black/90 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex flex-col lg:flex-row items-center justify-between gap-4">
                
                <div class="flex items-center gap-3 group cursor-default">
                    <i class="fa-brands fa-github text-4xl animate-pulse"></i>
                    <div>
                        <h1 class="text-3xl uppercase tracking-widest leading-none">SYS.GALLERY_V2</h1>
                        <p class="text-xs text-green-700 uppercase tracking-[0.2em]">>> ESTABLISHED CONNECTION</p>
                    </div>
                </div>

                <!-- Controls -->
                <div class="w-full lg:w-auto flex flex-col sm:flex-row gap-3 items-end sm:items-center bg-black p-2 border border-green-900">
                    <div class="flex gap-2 w-full sm:w-auto">
                        <div class="relative flex-1">
                            <label class="absolute -top-2 left-2 bg-black px-1 text-xs text-green-700 uppercase">User</label>
                            <input type="text" id="inputUser" placeholder="USR" class="w-full px-2 py-1">
                        </div>
                        <div class="relative flex-1">
                            <label class="absolute -top-2 left-2 bg-black px-1 text-xs text-green-700 uppercase">Repo</label>
                            <input type="text" id="inputRepo" placeholder="REPO" class="w-full px-2 py-1">
                        </div>
                        <div class="relative flex-1">
                            <label class="absolute -top-2 left-2 bg-black px-1 text-xs text-green-700 uppercase">Path</label>
                            <input type="text" id="inputPath" placeholder="/" class="w-full px-2 py-1">
                        </div>
                    </div>
                    <button onclick="loadGallery()" class="retro-btn px-6 py-2 text-xl font-bold w-full sm:w-auto">
                        <i class="fa-solid fa-bolt"></i> RUN
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 relative z-10">
        
        <!-- Console Output / Status -->
        <div class="border-l-4 border-green-700 pl-4 mb-8 font-mono text-lg">
            <p id="status-line-1" class="opacity-70">>> SYSTEM READY...</p>
            <p id="status-line-2" class="text-green-400 font-bold typing-effect"></p>
        </div>

        <!-- Error Box -->
        <div id="error-container" class="hidden border-2 border-red-500 bg-red-900/20 text-red-500 p-4 mb-6 uppercase animate-pulse">
            <strong class="block text-xl"><i class="fa-solid fa-triangle-exclamation"></i> CRITICAL ERROR</strong>
            <span id="error-message" class="font-mono mt-2 block"></span>
        </div>

        <!-- Loader -->
        <div id="loader" class="hidden flex flex-col justify-center items-center py-20">
            <i class="fa-solid fa-floppy-disk fa-bounce text-6xl mb-4 text-green-500"></i>
            <p class="text-2xl uppercase loader-text">DOWNLOADING ASSETS</p>
        </div>

        <!-- Gallery Grid -->
        <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            <!-- Images injected here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 opacity-50">
            <i class="fa-solid fa-ghost text-6xl mb-4"></i>
            <p class="text-2xl uppercase">>> NULL VOID DETECTED</p>
            <p class="text-sm uppercase mt-2">/DIR IS EMPTY</p>
        </div>

    </main>

    <!-- Retro Lightbox -->
    <div id="lightbox" class="fixed inset-0 z-[100] hidden bg-black flex flex-col">
        <!-- Header -->
        <div class="border-b border-green-500 p-4 flex justify-between items-center bg-black z-50">
            <div class="flex flex-col">
                <span class="text-xs text-green-700 uppercase">Filename</span>
                <span id="lb-filename" class="text-xl">IMAGE_001.JPG</span>
            </div>
            <button onclick="closeLightbox()" class="text-red-500 hover:text-red-400 text-4xl">
                <i class="fa-solid fa-square-xmark"></i>
            </button>
        </div>
        
        <!-- Image Container -->
        <div class="flex-grow flex items-center justify-center p-4 overflow-hidden relative" onclick="closeLightbox()">
             <!-- Grid Background behind image -->
            <div class="absolute inset-0 opacity-10 pointer-events-none" 
                 style="background-image: linear-gradient(var(--terminal-green) 1px, transparent 1px), linear-gradient(90deg, var(--terminal-green) 1px, transparent 1px); background-size: 40px 40px;">
            </div>
            
            <img id="lightbox-img" src="" class="max-h-full max-w-full object-contain shadow-[0_0_50px_rgba(51,255,0,0.2)] border border-green-900" style="image-rendering: auto;">
        </div>

        <!-- Footer Controls -->
        <div class="border-t border-green-500 p-4 bg-black flex justify-center gap-4 z-50">
            <a id="lb-dl-btn" href="#" target="_blank" download class="retro-btn px-8 py-2 text-lg flex items-center gap-2">
                <i class="fa-solid fa-download"></i> DOWNLOAD_ORIGINAL
            </a>
            <a id="lb-raw-btn" href="#" target="_blank" class="retro-btn px-8 py-2 text-lg flex items-center gap-2 border-dashed">
                <i class="fa-solid fa-code"></i> RAW_DATA
            </a>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const ALLOWED_EXTENSIONS = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'];
        // We use wsrv.nl as a free, public image proxy to resize images on the fly for speed
        const PROXY_BASE = "https://wsrv.nl/";
        
        const els = {
            user: document.getElementById('inputUser'),
            repo: document.getElementById('inputRepo'),
            path: document.getElementById('inputPath'),
            gallery: document.getElementById('gallery'),
            loader: document.getElementById('loader'),
            error: document.getElementById('error-container'),
            errorMsg: document.getElementById('error-message'),
            empty: document.getElementById('empty-state'),
            status1: document.getElementById('status-line-1'),
            status2: document.getElementById('status-line-2'),
            lightbox: document.getElementById('lightbox'),
            lbImg: document.getElementById('lightbox-img'),
            lbName: document.getElementById('lb-filename'),
            lbDl: document.getElementById('lb-dl-btn'),
            lbRaw: document.getElementById('lb-raw-btn'),
        };

        window.onload = () => {
            autoDetectConfig();
            if (els.user.value && els.repo.value) {
                loadGallery();
            }
        };

        function autoDetectConfig() {
            const hostname = window.location.hostname;
            const pathname = window.location.pathname;
            if (hostname.includes('github.io')) {
                const user = hostname.split('.')[0];
                const pathParts = pathname.split('/').filter(p => p);
                const repo = pathParts[0];
                if (user) els.user.value = user;
                if (repo) els.repo.value = repo;
            }
        }

        function log(msg, isError = false) {
            els.status1.innerText = els.status2.innerText; // Shift up
            els.status2.innerText = `>> ${msg}`;
            els.status2.className = isError ? "text-red-500 font-bold" : "text-green-400 font-bold typing-effect";
        }

        async function loadGallery() {
            const user = els.user.value.trim();
            const repo = els.repo.value.trim();
            const path = els.path.value.trim();

            if (!user || !repo) {
                log("MISSING CREDENTIALS", true);
                return;
            }

            // Reset
            els.gallery.innerHTML = '';
            els.error.classList.add('hidden');
            els.empty.classList.add('hidden');
            els.loader.classList.remove('hidden');
            log(`CONNECTING TO ${user}/${repo}...`);

            try {
                const apiUrl = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`HTTP_ERR_${response.status}: CHECK REPO VISIBILITY OR PATH`);
                }

                const data = await response.json();

                if (!Array.isArray(data)) throw new Error("TARGET IS NOT A DIRECTORY");

                const images = data.filter(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    return file.type === 'file' && ALLOWED_EXTENSIONS.includes(ext);
                });

                els.loader.classList.add('hidden');

                if (images.length === 0) {
                    els.empty.classList.remove('hidden');
                    log("SCAN COMPLETE: 0 ASSETS FOUND");
                    return;
                }

                log(`DATA RECEIVED: ${images.length} OBJECTS FOUND`);
                renderImages(images);

            } catch (err) {
                els.loader.classList.add('hidden');
                els.errorMsg.innerText = err.message;
                els.error.classList.remove('hidden');
                log("OPERATION FAILED", true);
            }
        }

        function renderImages(images) {
            images.forEach((img, index) => {
                // COMPRESSION TRICK:
                // Use wsrv.nl to generate a small thumbnail on the fly.
                // ?url=...&w=400&q=50 (Width 400px, Quality 50%)
                const thumbUrl = `${PROXY_BASE}?url=${encodeURIComponent(img.download_url)}&w=400&q=50&output=webp`;

                const card = document.createElement('div');
                card.className = "image-card relative aspect-square cursor-pointer overflow-hidden pixel-in";
                card.style.animationDelay = `${index * 50}ms`; // Staggered animation

                card.onclick = () => openLightbox(img.download_url, img.name);

                card.innerHTML = `
                    <div class="absolute top-0 left-0 bg-black/80 p-1 z-10 border-b border-r border-green-900">
                        <span class="text-[10px] uppercase tracking-widest text-green-500">IMG_${String(index + 1).padStart(3, '0')}</span>
                    </div>
                    <img src="${thumbUrl}" 
                         loading="lazy" 
                         alt="${img.name}" 
                         class="w-full h-full object-cover opacity-80 hover:opacity-100 transition-opacity duration-300">
                    
                    <div class="absolute bottom-0 w-full bg-black/90 border-t border-green-900 p-1">
                        <p class="text-xs truncate text-center text-green-600 uppercase hover:text-white transition-colors">${img.name}</p>
                    </div>
                `;

                els.gallery.appendChild(card);
            });
        }

        function openLightbox(url, name) {
            els.lbImg.src = ""; // clear prev
            // For lightbox, we load the FULL original quality, but maybe we can use a larger proxy first if needed.
            // Let's stick to original for "Download" correctness.
            els.lbImg.src = url;
            
            els.lbName.innerText = name;
            els.lbDl.href = url;
            els.lbDl.download = name; // Hint to browser
            els.lbRaw.href = url;
            
            els.lightbox.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            els.lightbox.classList.add('hidden');
            els.lbImg.src = '';
            document.body.style.overflow = 'auto';
        }

        // Listen for Esc
        document.addEventListener('keydown', (e) => {
            if(e.key === "Escape") closeLightbox();
        });

        // Prevent lightbox close when clicking controls
        els.lbDl.onclick = (e) => e.stopPropagation();
        els.lbRaw.onclick = (e) => e.stopPropagation();
    </script>
</body>
</html>
